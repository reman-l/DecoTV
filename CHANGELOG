## [Unreleased]

## [0.6.0] - 2025-10-30

### Added

- ✨ 实现智能成人内容过滤系统
  - 视频源添加 `is_adult` 字段，可手动标记成人资源
  - 后台管理：视频源表格新增"成人资源"列，支持快速切换标记
  - 批量操作：新增"标记成人"和"取消标记"按钮，支持批量处理
  - 双重过滤：同时支持手动标记（is_adult）和关键词过滤（yellowWords）
  - 智能识别：自动检测 AV-/成人/伦理/福利/里番 等前缀
- 📦 增强导入导出功能
  - 导出现在包含 `is_adult` 字段
  - 导入支持读取 `is_adult` 字段，完整保留成人资源标记

### Changed

- 🔧 重命名"禁用黄色过滤器"为"启用成人内容过滤"，语义更清晰
  - 默认启用过滤（保护用户），可选择关闭显示所有内容
  - 优化站点配置说明文字，更易理解
- 🎨 优化成人资源标记 UI
  - 使用红色渐变开关（from-red-500 to-pink-500），视觉清晰
  - 批量操作按钮带 🔞 图标
- ⚡ 更新所有搜索 API 的过滤逻辑
  - 普通搜索、单源搜索、WebSocket 流式搜索、搜索建议全部支持
  - 先检查 is_adult 标记，再检查关键词

### Fixed

- 🐛 修复版本号显示重复 v 前缀的问题（vv0.5.0 → v0.5.0）
- 🔧 修复"禁用黄色过滤器"逻辑混乱问题，现在语义清晰

### Removed

- 🗑️ 移除后台管理页面 TVBox 配置中的版本检测功能（根据用户反馈优化）

## [0.5.0] - 2025-10-28

### Added

- ✨ 新增智能搜索排序功能
  - 完全匹配（标题 === 关键词）：优先级最高（100分）
  - 开头匹配（标题以关键词开头）：优先级高（80分）
  - 包含完整关键词（标题包含关键词）：优先级中（60分）
  - 模糊匹配（标题包含关键词部分字符）：优先级低（20-40分）
  - 支持按顺序字符匹配，如"后浪"可匹配"后XXX浪"
  - 使用 Levenshtein 距离算法计算相似度
  - 最新年份的作品获得额外加分（最多+10分）
  - 有豆瓣信息的作品获得额外加分（+5分）
- 📝 新增搜索优化详细说明文档（SEARCH_OPTIMIZATION.md）
- 📝 新增性能优化报告文档（PERFORMANCE_OPTIMIZATION.md）

### Changed

- ⚡ 大幅优化粒子背景性能，降低 CPU 占用 70-80%
  - 粒子数量从 120 个减少到 40 个（降低 66%）
  - 限制帧率到 30fps（原来 60fps，降低 50%）
  - 优化连接线算法：每个粒子最多 3 条连接，复杂度从 O(n²) 降到 O(n)
  - 连接距离从 120px 减少到 100px
  - 使用 useMemo 缓存主题配置
  - 启用 Canvas desynchronized 模式提升渲染性能
  - 总 CPU 操作数从 435,660/秒降至 4,800/秒（降低 98.9%）
- 🎨 优化亮色模式 UI 显示效果，提升文字可读性
  - 降低背景不透明度：从 80% 降到 30%
  - 渐变色自适应：亮色模式使用高亮度（95%）浅色系，暗色模式保持深色系（60%）
  - 粒子颜色调整：亮色模式使用更深的颜色（50% 亮度），暗色模式保持高亮（65%）
  - 连接线优化：亮色模式使用更深更透明的连接线
  - 拖尾效果：亮色模式使用白色拖尾，暗色模式使用黑色拖尾
- ✨ 保留粒子呼吸效果（透明度渐变）和发光效果
- ✨ 添加拖尾效果，视觉更柔和流畅
- 🔧 搜索结果现在按相关性智能排序，精确匹配优先显示
- 🎯 聚合模式现在只显示相关度高的结果，提升搜索精确度

### Fixed

- 🐛 修复粒子背景主题模式实时响应问题：现在切换主题后立即生效
- 🐛 修复中文乱码问题：恢复所有中文文本正常显示
- 🐛 修复聚合模式搜索不精确问题：过滤掉标题完全不包含搜索关键词的内容

## [0.4.0] - 2025-10-26

### Added

- ✨ 完整支持 OrionTV 1.3.11 客户端
- ✨ 添加 `/api/search/resources` API 获取视频源列表
- ✨ 添加 `/api/search/one` API 在指定源搜索视频
- ✨ 完整的 CORS 支持（OrionTV 兼容）
- ✨ 添加 OPTIONS 方法处理 CORS 预检请求
- 📝 新增 OrionTV 使用指南文档
- 🔐 支持 Cookie-based 认证（OrionTV 兼容）
- 🐳 Docker 镜像添加版本号标签（如 v0.4.0），支持版本固定和回滚

### Changed

- 🎨 更新 OrionTV 使用指南，说明正确的配置方式
- ⚡ 优化 API 响应头，添加完整 CORS 支持
- 📚 完善 LunaTV 兼容 API 文档
- 📦 优化 Docker 部署文档，添加版本标签使用说明

### Fixed

- 🐛 修复 `/api/search/resources` 缺少认证检查的问题
- 🐛 修复 `/api/search/one` 缺少 CORS 头的问题
- 🔧 修复 OrionTV 1.3.11 "网络错误" 提示
- 🔧 修复版本更新检测：旧版本用户现在能正确看到新版本提示
- 🔧 修复版本号显示错误：从 GitHub 获取真实的远程版本号而非本地版本

### Technical

- 🏗️ 同时支持 OrionTV API 和 TVBox 配置两种模式
- 🔄 播放记录、收藏、搜索历史在 OrionTV 和 Web 端实时同步
- 📱 支持 Apple TV 和 Android TV 平台
- 🌐 完整的多设备数据同步支持
- 🔧 GitHub Actions 自动为每个版本生成对应的 Docker 标签

## [0.2.0] - 2025-10-05

### Added

- 版本检查和更新检测系统
- 智能时间戳版本管理
- 管理后台版本检查器组件
- 自动更新提醒功能

### Changed

- TVBox JAR 加载系统增强，支持多源智能切换
- 优化 ESLint 配置，解决 Git 提交阻塞问题
- 改进 Docker 构建配置，减少超时警告

### Fixed

- 修复 TVBox spider unreachable 错误
- 解决版本信息面板 GitHub 仓库链接问题

## [100.0.0] - 2025-08-26

### Added

- 新增对 SITE_BASE 环境变量的支持，解决 m3u8 重写时 base url 错误的问题

### Changed

- 移除授权相关逻辑
- 移除代码混淆
- 移除 melody-cdn-sharon

## [4.3.0] - 2025-08-26

### Added

- 支持将 IPTV 频道添加到收藏中

### Changed

- 禁用 flv 直播，仅支持 m3u8 直播
- 降低代理 ts 分片的内存占用

## [4.2.1] - 2025-08-26

### Fixed

- 修复直播源加载失败或离开页面后依然无限加载的问题

## [4.2.0] - 2025-08-26

### Added

- 支持 flv 直播和直播地址解析到 mp4 的处理
- 增加直播台标的 proxy 以防止 cors
- 支持播放页选集分组的滚动翻页

### Changed

- 管理后台页面的按钮增加加载中的 UI

### Fixed

- /api/proxy/m3u8 仅对 m3u8 内容反序列化，降低内存和 CPU 消耗

## [4.1.1] - 2025-08-25

### Changed

- 增加对 url-tvg 和多 epg url 的支持

### Fixed

- 修复 epg 数据清洗中去重叠逻辑未考虑日期导致的问题

## [4.1.0] - 2025-08-24

### Added

- 解析 m3u 自带的 epg 和自定义 epg，增加今日节目单

### Changed

- 直播源数据刷新改为并发刷新

## [4.0.0] - 2025-08-24

### Added

- 增加 iptv 订阅和播放功能

### Changed

- 搜索页面视频卡片移动端/右键菜单添加豆瓣链接
- 搜索建议遵循色情过滤

## [3.2.1] - 2025-08-22

### Changed

- 新增色色过滤分类
- 调整搜索建议框层级

## [3.2.0] - 2025-08-22

### Added

- 视频源管理支持批量启用、禁用、删除
- 用户管理支持批量设置用户组
- 视频卡片右键/长按菜单新增新标签页播放

### Changed

- 视频卡片移动端 hover 时仅保留播放按钮
- 微调管理页面 UI 和视频卡片右键/长按菜单中的收藏样式

### Fixed

- 修复了搜索栏 enter 键自动选中第一个建议项的问题

## [3.1.2] - 2025-08-22

### Fixed

- 修复移动端卡片无法点击的问题

## [3.1.1] - 2025-08-21

### Fixed

- 修复了视频卡片 hover 的非播放按钮点击后进入播放页的问题

## [3.1.0] - 2025-08-21

### Added

- 增加用户组管理和用户组播放源限制
- 增加管理面板视频源有效性检查
- 搜索栏增加一键删除按钮

### Changed

- 放宽授权心跳对于网络问题的判断标准
- 统一管理面板弹窗使用 createPortal
- VideoCard 允许移动端响应 hover 事件
- 移动端布局 header 常驻，搜索按钮移动到 header 右侧
- 调大搜索接口超时时间

### Fixed

- 修复 bangumi 返回的整数评分无小数导致 UI 不对齐的问题

## [3.0.2] - 2025-08-20

### Changed

- 优化机器码生成逻辑

### Fixed

- 修复 redis url 不支持 rediss 协议的问题

## [3.0.1] - 2025-08-20

### Fixed

- 修复授权初始化错误

## [3.0.0] - 2025-08-20

### Added

- 防盗卖加固
- 支持自定义用户可用视频源

### Changed

- 右键视频卡片可弹出操作菜单

### Fixed

- 过滤掉集数为 0 的搜索结果

## [2.7.1] - 2025-08-17

### Fixed

- 修复 iOS 下版本面板可穿透滚动背景的问题

## [2.7.0] - 2025-08-17

### Added

- 视频卡片新增移动端操作面板，优化触控屏操作体验

### Changed

- 优化集数标题的匹配和展示逻辑

### Fixed

- 修复设置面板和修改密码面板背景可被拖动的问题

## [2.6.0] - 2025-08-17

### Added

- 新增搜索流式输出接口，并设置流式搜索为默认搜索接口，优化搜索体验
- 新增源站搜索结果内存缓存，粒度为源站+关键词+页数，缓存 10 分钟
- 新增豆瓣 CDN provided by @JohnsonRan

### Changed

- 搜索结果默认为无排序状态，不再默认按照年份排序
- 常规搜索接口无结果时，不再设置响应的缓存头
- 移除豆瓣数据源中的 cors-anywhere 方式

### Fixed

- 数据导出时导出站长密码，保证迁移到新账户时原站长用户可正常登录
- 聚合卡片优化移动端源信息展示

## [2.4.1] - 2025-08-15

### Fixed

- 对导入和 db 读取的配置文件做自检，防止 USERNAME 修改导致用户状态异常

## [2.4.0] - 2025-08-15

### Added

- 支持 kvrocks 存储（持久化 kv 存储）

### Fixed

- 修复搜索结果排序不稳定的问题
- 导入数据时同时更新内存缓存的管理员配置

## [2.3.0] - 2025-08-15

### Added

- 支持站长导入导出整站数据

### Changed

- 仅允许站长操作配置文件
- 微调搜索结果过滤面板的移动端样式

## [2.2.1] - 2025-08-14

### Fixed

- 修复了筛选 panel 打开时滚动页面 panel 不跟随的问题

## [2.2.0] - 2025-08-14

### Added

- 搜索结果支持按播放源、标题和年份筛选，支持按年份排序
- 搜索界面视频卡片展示年份信息，聚合卡片展示播放源

### Fixed

- 修复 /api/search/resources 返回空的问题
- 修复 upstash 实例无法编辑自定义分类的问题

## [2.1.0] - 2025-08-13

### Added

- 支持通过订阅获取配置文件

### Changed

- 微调部分文案和 UI
- 删除部分无用代码

## [2.0.1] - 2025-08-13

### Changed

- 版本检查和变更日志请求 Github

### Fixed

- 微调管理面板样式

## [2.0.0] - 2025-08-13

### Added

- 支持配置文件在线配置和编辑
- 搜索页搜索框实时联想
- 去除对 localstorage 模式的支持

### Changed

- 播放记录删除按钮改为垃圾桶图标以消除歧义

### Fixed

- 限制设置面板的最大长度，防止超出视口

## [1.1.1] - 2025-08-12

### Changed
- 修正 zwei 提供的 cors proxy 地址
- 移除废弃代码

### Fixed
- [运维] docker workflow release 日期使用东八区日期

## [1.1.0] - 2025-08-12

### Added
- 每日新番放送功能，展示每日新番放送的番剧

### Fixed
- 修复远程 CHANGELOG 无法提取变更内容的问题

## [1.0.5] - 2025-08-12

### Changed
- 实现基于 Git 标签的自动 Release 工作流

## [1.0.4] - 2025-08-11

### Added
- 优化版本管理工作流，实现单点修改

### Changed
- 版本号现在从 CHANGELOG 自动提取，无需手动维护 VERSION.txt

## [1.0.3] - 2025-08-11

### Changed

- 升级播放器 Artplayer 至版本 5.2.5

## [1.0.2] - 2025-08-11

### Changed

- 版本号比较机制恢复为数字比较，仅当最新版本大于本地版本时才认为有更新
- [运维] 自动替换 version.ts 中的版本号为 VERSION.txt 中的版本号

## [1.0.1] - 2025-08-11

### Fixed

- 修复版本检查功能，只要与最新版本号不一致即认为有更新

## [1.0.0] - 2025-08-10

### Added

- 基于 Semantic Versioning 的版本号机制
- 版本信息面板，展示本地变更日志和远程更新日志