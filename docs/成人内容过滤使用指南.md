# 🔒 成人内容过滤使用指南

## 📱 功能概述

DecoTV 现在支持通过 **URL 参数**灵活控制成人内容过滤,无需修改客户端软件!

**适用客户端**:

- ✅ OrionTV (Apple TV / Android TV)
- ✅ TVBox / 猫影视 (Android / Android TV)
- ✅ Web 端浏览器

---

## 🎯 OrionTV 用户指南

### ⭐ 推荐方式：使用路径前缀（最简单）

DecoTV 支持通过不同的 URL 路径访问不同的过滤模式，**无需任何参数配置**！

#### 方式 1: 家庭安全模式（默认,推荐家庭使用）

**API 地址**:

```
https://your-domain.com/
```

**效果**:

- ✅ 自动过滤成人资源源
- ✅ 自动过滤包含敏感关键词的视频
- ✅ 搜索结果干净安全

---

#### 方式 2: 完整内容模式（成人用户）

**API 地址**:

```
https://your-domain.com/adult/
```

**效果**:

- ✅ 显示所有视频源（包括成人源）
- ✅ 搜索结果包含所有内容
- ⚠️ 仅限成人使用

> 💡 **重要提示**:
>
> - 注意 URL 结尾的 `/` 不能省略
> - OrionTV 会自动在这个基础 URL 后拼接 API 路径
> - 例如：`https://your-domain.com/adult/` → `https://your-domain.com/adult/api/search/resources`
> - 路径会被自动重写为：`https://your-domain.com/api/search/resources?adult=1`

---

### 备用方式：使用 URL 参数（高级用户）

**注意**: 由于 OrionTV 的限制，URL 参数方式**仅适用于 Web 端和部分支持的客户端**。

#### 家庭安全模式

**API 地址**:

```
https://your-domain.com
```

#### 完整内容模式

**API 地址**:

```
https://your-domain.com?adult=1
```

> ⚠️ **OrionTV 限制**: OrionTV 可能不会将 API 地址中的查询参数传递到后续请求，因此推荐使用路径前缀方式。

---

### 配置步骤

1. **打开 OrionTV**
2. **进入设置** → **API 地址**
3. **输入对应模式的 URL**（见上方）
4. **保存并重启应用**

---

## 📺 TVBox 用户指南

### 🎯 默认模式（推荐,智能搜索已内置）⭐

**订阅地址**:

```
https://your-domain.com/api/tvbox/config
```

**特点**:

- ✅ **默认启用智能搜索代理** - 自动解决 TVBox 搜索不精确问题
- ✅ 智能搜索结果排序（相关度优先）
- ✅ 自动过滤成人资源源（家庭安全模式）
- ✅ 自动过滤不相关搜索结果
- ⚡ 开箱即用,无需配置

> 💡 **提示**: 默认配置已经包含智能搜索功能,**无需**再添加 `mode=smart` 参数!

---

### 方式 1: 完整内容模式（成人用户）

**订阅地址**:

```
https://your-domain.com/api/tvbox/config?filter=off
```

**特点**:

- ✅ 智能搜索仍然启用（保证搜索准确性）
- ✅ 包含所有视频源（包括成人源）
- ⚠️ 可能包含成人内容
- ⚠️ 仅限成人使用

---

### 方式 2: 直连原始 API（高级用户,不推荐）

**订阅地址**:

```
https://your-domain.com/api/tvbox/config?proxy=off
```

**特点**:

- ⚠️ 禁用智能搜索代理,直连上游 API
- ⚠️ 搜索结果可能不精确
- ✅ 响应速度最快
- 👨‍💻 仅供调试或网络环境特殊的高级用户使用

**如果想要直连 + 完整内容**:

```
https://your-domain.com/api/tvbox/config?proxy=off&filter=off
```

---

### 配置步骤

1. **打开 TVBox / 猫影视**
2. **设置** → **配置地址**
3. **输入对应模式的订阅地址**（见上方）
4. **刷新配置**

---

## 🌐 Web 端用户

Web 端自动使用全局配置（环境变量 `NEXT_PUBLIC_DISABLE_YELLOW_FILTER`）,无需额外设置。

---

## 🔧 URL 参数完整说明

### 成人内容控制参数

| 参数     | 值                 | 说明                 | 示例          |
| -------- | ------------------ | -------------------- | ------------- |
| `adult`  | `1` 或 `true`      | 显示成人内容         | `?adult=1`    |
| `adult`  | `0` 或 `false`     | 隐藏成人内容         | `?adult=0`    |
| `filter` | `off` 或 `disable` | 禁用过滤（显示成人） | `?filter=off` |
| `filter` | `on` 或 `enable`   | 启用过滤（隐藏成人） | `?filter=on`  |

### 智能搜索控制参数（TVBox）

| 参数     | 值                 | 说明                                    |
| -------- | ------------------ | --------------------------------------- |
| `proxy`  | `off` 或 `disable` | 禁用智能搜索代理,直连原始 API（不推荐） |
| `strict` | `1`                | 严格匹配模式（只返回高度相关结果）      |

> 💡 **说明**: 智能搜索默认启用,无需额外参数。仅在特殊情况下使用 `proxy=off` 禁用。

### TVBox 配置模式参数（兼容性）

| 参数   | 值            | 说明           |
| ------ | ------------- | -------------- |
| `mode` | `fast`        | 快速切换模式   |
| `mode` | `yingshicang` | 影视仓兼容模式 |
| `mode` | `safe`        | 最小化配置模式 |

> ⚠️ **已移除**: `mode=smart` 已被移除,智能搜索现在是默认行为。

---

## 📖 使用场景示例

### 场景 1: 家庭用户 - OrionTV

**需求**: 家里有小孩,需要完全屏蔽成人内容

**配置**:

```
API地址: https://your-domain.com
```

**效果**: 所有成人源和敏感内容被自动过滤

---

### 场景 2: 成人用户 - OrionTV

**需求**: 想看所有内容,不需要过滤

**配置**:

```
API地址: https://your-domain.com?adult=1
```

**效果**: 显示所有内容,包括成人资源

---

### 场景 3: TVBox 默认体验（推荐）⭐

**需求**: 想要最好的搜索体验,自动过滤成人内容

**配置**:

```
订阅地址: https://your-domain.com/api/tvbox/config
```

**效果**:

- ✅ 智能搜索已内置,搜索结果更精准
- ✅ 自动排序,最相关的在前面
- ✅ 自动过滤成人内容
- ✅ 自动过滤不相关内容

> 💡 **说明**: 默认配置已经是最优方案,无需额外配置!

---

### 场景 4: 两个设备不同需求

**设备 1** (客厅电视,家庭共用):

```
订阅地址: https://your-domain.com/api/tvbox/config
```

效果: 智能搜索 + 过滤成人内容

**设备 2** (卧室电视,个人使用):

```
订阅地址: https://your-domain.com/api/tvbox/config?filter=off
```

效果: 智能搜索 + 显示所有内容

**效果**: 同一个服务器,两个设备使用不同过滤策略

---

## 🛠️ 高级功能

### 组合参数使用

可以同时使用多个参数:

**智能搜索 + 完整内容 + 严格匹配**:

```
https://your-domain.com/api/tvbox/config?mode=smart&filter=off&strict=1
```

**影视仓模式 + 家庭安全**:

```
https://your-domain.com/api/tvbox/config?mode=yingshicang&filter=on
```

---

## ❓ 常见问题

### Q1: 修改 URL 参数后没有生效怎么办？

**A**: 需要重启客户端或刷新配置

- OrionTV: 重启应用
- TVBox: 设置 → 刷新配置

---

### Q2: 智能搜索模式会变慢吗？

**A**: 会稍慢一点（增加约 100-500ms）,但搜索结果质量大幅提升:

- ✅ 自动排序,最相关的在前面
- ✅ 过滤无关内容
- ✅ 过滤成人内容

对于"搜索不精确"问题严重的用户,**强烈推荐使用 smart 模式**。

---

### Q3: 如何知道当前使用的是哪种模式？

**A**:

1. **Web 端**: 查看响应头 `X-Adult-Filter`
2. **OrionTV**: 调用 `/api/server-config` 查看 `AdultFilterEnabled`
3. **TVBox**: 查看日志（如果开启了调试）

---

### Q4: 全局配置和 URL 参数冲突怎么办？

**A**: **URL 参数优先级更高**,会覆盖全局配置

优先级: `URL 参数` > `全局环境变量 DISABLE_YELLOW_FILTER`

---

### Q5: 可以为不同用户设置不同过滤策略吗？

**A**: 可以! 每个用户使用不同的 URL:

**用户 A (家庭模式)**:

```
https://your-domain.com?adult=0
```

**用户 B (完整模式)**:

```
https://your-domain.com?adult=1
```

---

## 🔐 管理员配置

### 环境变量

```env
# 全局默认设置（可被 URL 参数覆盖）
NEXT_PUBLIC_DISABLE_YELLOW_FILTER=false  # false = 启用过滤（默认安全）
```

### 视频源标记

在后台管理页面 → 视频源配置 → 勾选"成人资源"标记

被标记的源在启用过滤时会被自动隐藏。

---

## 📊 过滤机制说明

### 三重过滤机制

1. **源级别过滤**: 整个视频源被标记为成人资源 → 完全隐藏
2. **关键词过滤**: 视频分类名称包含敏感词 → 过滤该分类
3. **智能排序**: 按相关性排序,不相关的往后排

### 敏感关键词库

包含但不限于:

- 伦理片、福利、里番动漫
- 制服诱惑、国产传媒
- 无码、有码、写真热舞
- 等 27+ 个关键词

完整列表见: `src/lib/yellow.ts`

---

## 🎉 总结

**家庭用户**: 使用默认地址即可,无需任何配置

**成人用户**: 在 URL 后添加 `?adult=1` 或 `?filter=off`

**TVBox 搜索问题**: 使用 `?mode=smart` 解决

**灵活控制**: 不同设备使用不同 URL,互不影响

---

**需要帮助?** 查看完整文档或联系管理员

**最后更新**: 2025-10-31
